<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Flight Search</title>
    <link th:href="@{/css/styles.css}" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/styles.css">
</head>
<body>

<div class="buscas-container">
    <div class="busca-inputs">
        <input class="departureAirPort" type="text" name="departureCode" placeholder="Origem (ex: GRU)" value="GRU">
        <input class="arrivalAirPort" type="text" name="arrivalCode" placeholder="Destino (ex: FLN)" value="FLN">
        <input class="departureDate" type="date" name="flightDate" value="2024-08-01">
        <input class="passengerAmount" type="number" name="numberPassenger" placeholder="Passageiros" value="1">
        <button class="searchButton" id="searchButton">Buscar</button>
    </div>
</div>

<div class="resultados-container" id="results">
    <!-- Resultados aparecerão aqui -->
</div>

<script>
    document.getElementById("searchButton").addEventListener("click", function() {
        const departureCode = document.querySelector(".departureAirPort").value;
        const arrivalCode = document.querySelector(".arrivalAirPort").value;
        const flightDate = document.querySelector(".departureDate").value;
        const numberPassenger = document.querySelector(".passengerAmount").value;

        fetch(`/api/search?originAirportCode=${departureCode}&destinationAirportCode=${arrivalCode}&departureDate=${flightDate}&adults=${numberPassenger}`)
            .then(response => response.json())  // Assume JSON response
            .then(data => {
                const resultsContainer = document.getElementById("results");
                resultsContainer.innerHTML = '';  // Limpa o conteúdo anterior

                if (Array.isArray(data) && data.length > 0) {
                    const ul = document.createElement('ul');
                    data.forEach(flight => {
                        const li = document.createElement('li');

                        // Calcula o valor total
                        const miles = flight.miles;
                        const costTax = flight.costTax;
                        let valueInReais;

                        // Calcula o valor com base em milhares de milhas
                        const milesInThousands = miles / 1000;

                        if (milesInThousands <= 50) {
                            valueInReais = milesInThousands * 17.5;
                        } else {
                            valueInReais = milesInThousands * 17;
                        }

                        valueInReais += costTax;  // Adiciona a taxa ao valor calculado

                        li.innerHTML = `${flight.departureAirportCode} ${flight.departureTime} -> ${flight.arrivalAirportCode} ${flight.arrivalTime} <br> Milhas: ${flight.miles} <br> Taxa: ${flight.costTax.toFixed(2)} <br> Valor Total: R$${valueInReais.toFixed(2)}`;
                        ul.appendChild(li);
                    });
                    resultsContainer.appendChild(ul);
                } else {
                    resultsContainer.textContent = 'Nenhum voo encontrado.';
                }
            })
            .catch(error => console.error('Erro:', error));
    });

</script>


</body>
</html>
